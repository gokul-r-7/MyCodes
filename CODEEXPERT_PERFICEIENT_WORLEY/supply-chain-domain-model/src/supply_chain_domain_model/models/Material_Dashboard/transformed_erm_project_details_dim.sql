{%- set run_date = "CURRENT_TIMESTAMP()" -%}


{{
    config(
        materialized='incremental',
        incremental_strategy='insert_overwrite',
        file_format='iceberg',
        iceberg_expire_snapshots='False', 
        custom_location=target.location ~ 'transformed_erm_project_details_dim/',
        table_properties={'write.target-file-size-bytes': '268435456'},
        on_schema_change='append_new_columns',
        full_refresh=true
        ) 
}}


select 
    pj.hull_inst_draw_no,
    pj.fabricate_proj,
    pj.proj_phase_no,
    pj.integr_dsg_proj_id,
    pj.fin_proj_id,
    pj.use_proj_fin_acc_code,
    pj.dflt_mto_validation,
    pj.tax_yn,
    pj.unit_dflt_hdr_no,
    pj.default_mr_filter_json,
    pj.tmr_no_setup_method,
    pj.use_proj_cont,
    pj.rfq_no_setup_method,
    pj.create_plan_mat,
    pj.manual_payments,
    pj.use_dyn_mat_allocation,
    pj.auto_mto_priority,
    pj.use_time_phase_budg,
    pj.budg_approved,
    pj.fa_no_setup_method,
    pj.is_vat_incl,
    pj.dflt_3d_integration,
    pj.aveva_net_imp_stag_area_no,
    pj.std_mat_set_no,
    pj.scheme_no,
    pj.proj_trx_po,
    pj.arf_imp_stag_area_no,
    pj.allow_spec_unapprove,
    pj.default_ms_filter_json,
    pj.dflt_mr_grp_filter_json,
    pj.use_weight_factors,
    pj.proj_set_behaviour,
    pj.auto_sync_mr_tmr,
    pj.req_level,
    pj.proj_no,
    pj.proj_id,
    pj.descr,
    pj.owner,
    pj.stat,
    pj.sys_no_used,
    pj.sister_proj_no,
    pj.cost_acc_used,
    pj.mars_plan_used,
    pj.clean_pl_item,
    pj.gen_budg,
    pj.clean_pl_item_date,
    pj.gen_steel_mat_stat,
    pj.sys_part_of_proj_comp_id,
    pj.inv_allowed,
    pj.report_hour_allowed,
    pj.template_proj,
    pj.stress_curve_no,
    pj.proj_manager_usr_id,
    pj.contract_id,
    pj.contract_date,
    pj.project_type_no,
    pj.length_overall,
    pj.length_load_water_line,
    pj.width,
    pj.draught,
    pj.displacement,
    pj.light_ship_displacement,
    pj.gross_tonnage,
    pj.netto_tonnage,
    pj.speed_max,
    pj.speed_cruise,
    pj.fuel_capacity,
    pj.fresh_water_capacity,
    pj.range,
    pj.installed_power,
    pj.installed_generating_capacity,
    pj.steel_wgt,
    pj.imo_no,
    pj.classification,
    pj.country_id,
    pj.crew,
    pj.sister_norm_hour_idx,
    pj.legal_entity_no,
    pj.start_date,
    pj.finish_date,
    pj.has_fixed_finish,
    pj.default_calendar_no,
    pj.default_delivery_site_no,
    pj.design_proj_id,
    pj.proj_site,
    pj.use_expedite,
    pj.deliv_desig_no,
    pj.receive_batch_fab_only,
    pj.allow_activity_on_fab_pl,
    pj.dflt_allow_activity_on_fab_pl,
    pj.customer_col_0,
    pj.customer_col_1,
    pj.customer_col_2,
    pj.customer_col_3,
    pj.customer_col_4,
    pj.customer_col_5,
    pj.customer_col_6,
    pj.customer_col_7,
    pj.customer_col_8,
    pj.customer_col_9,
    pj.po_no_setup_method,
    pj.def_date,
    pj.def_usr_id,
    pj.upd_date,
    pj.upd_usr_id,
    pj.contract_type,
    pj.installation_loc,
    pj.installation_addr_no,
    pj.home_office_location,
    pj.home_office_addr_addr_1,
    pj.home_office_addr_addr_2,
    pj.home_office_addr_addr_3,
    pj.home_office_addr_addr_4,
    pj.home_office_addr_postal_code,
    pj.home_office_addr_city,
    pj.home_office_addr_country_id,
    pj.home_office_addr_region,
    pj.home_office_addr_state_province,
    pj.home_office_phone,
    pj.home_office_fax,
    pj.client_logo,
    pj.client_no,
    pj.client_addr_no,
    pj.source_model,
    pj.proj_comp_unit_id,
    pj.proj_comp_sep,
    pj.vds_doc_seq,
    pj.vendor_resubmission_period,
    pj.home_office_addr_county,
    pj.conv_length_unit_id,
    pj.anet_config_location,
    pj.prim_length_unit_id,
    cast(pj.execution_date as date) as etl_load_date,
    {{run_date}} as model_created_date,
    {{run_date}} as model_updated_date,
    {{ generate_load_id(model) }} as model_load_id
from   
    {{ source('curated_erm', 'proj') }} pj
where 
    pj.is_current = 1