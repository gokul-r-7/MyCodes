import pandas as pd

# Load the dataset
file_path = '/mnt/data/test_file.csv'
data = pd.read_csv(file_path)

# List of date columns
date_columns = [col for col in data.columns if col.endswith('-2024')]

# Filter rows where parent_id_old is present in hierarchy_id
filtered_data = data[
    data['parent_id_old'].isin(data['hierarchy_id'])
]

# Separate Apple iOS and Google Android rows
ios_data = filtered_data[filtered_data['operating_system_type'] == 'Apple iOS']
android_data = filtered_data[filtered_data['operating_system_type'] == 'Google Android']

# Sum the date column values for each operating system
ios_sums = ios_data[date_columns].sum()
android_sums = android_data[date_columns].sum()

# Add the sums for Apple iOS and Google Android
denominator = ios_sums + android_sums

# Save the result as a CSV file (optional)
output_path = '/mnt/data/denominator_filtered_sums.csv'
denominator.to_csv(output_path, header=["Total_Sum"], index_label="Date")

print(f"Denominator values calculated and saved to {output_path}")